<%- include("../../views/partials/admin/header") %>


 
<!-- partial -->
<div class="main-panel">
  <div class="content-wrapper">
    <div class="row">
      <div class="col-12 grid-margin stretch-card">
        <div class="card corona-gradient-card">
          <div class="card-body py-0 px-0 px-sm-3">
            <div class="row align-items-center">
              <div class="col-12 col-sm-12 col-xl-12">
                <h1 style="text-align:center ; font-size: 50px;">User Details </h1>
                              
              </div>
              
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="main-panel">
      <div class="content-wrapper">
                

<div class="main-panel">

  <form action="/admin/searchUser" method="GET">
    <label for="search">Search Users:</label>
    <input type="text" id="search" name="searchUser" placeholder="Search by name" required>
    <button type="submit">Search</button>
</form>

  <div class="content-wrapper">
    <div class="row">
      <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">User Details</h4>
            <div class="table-responsive">
              <table class="table table-hover" border="1">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Listed</th>
                    <!-- <th>Actions</th> -->
                  </tr>
                </thead>
                <tbody>
                  <% if (users && users.length > 0) { %>
                  <%for(let i=0;i<users.length;i++){%> 
                                
                  <tr>
                 <td><%=users[i].name%></td>
                  <td><%=users[i].email%></td>
               
                 <td><%if(users[i].isBlocked===false){%>
                  
                  <button class="btn btn-danger delete-btn"name="blockuser" onclick="blockUser(this.closest('tr'), '<%=users[i]._id%>','<%=users[i].name%>')">Block</button>
                 <!--  -->
                  <%}else{%>
                  <button class="btn btn-success" style="width: 80px;">
                  <a href="/admin/unblockUser?id=<%=users[i]._id%>" class="text-white" style="text-decoration: none;">Unblock</a>
                  </button>
                  <%}%> 
                    </td>
                     </tr>                         
                     <% } }else { %>
                      <tr>
                        <td colspan="5">No users found</td>
                     </tr>
                  <% } %>
                         
                      </tbody>
                  </table>                      
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>





  <!-- content-wrapper ends -->
  <!-- partial:partials/_footer.html -->
       

  <!-- partial -->
</div>
<!-- main-panel ends -->
</div>
<!-- page-body-wrapper ends -->
</div>
<div class="container mt-3">
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center mb-20" style="margin-right: 200px;">
 <%for(let i=1;i<=totalPages;i++){%>
  <li class="page-item <%=(i===currentPage) ? 'active' : '' %>">
      <a class="page-link" href="?page=<%= i %>"><%= i %></a>
  </li>
  <%}%>
  </ul>
</nav>
</div>

  <%-include("../../views/partials/admin/footer")%> 

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  
function blockUser(row,userId,userName) {
 const buttonlabel=document.querySelector('[name=blockuser]')
 const currentText = button.innerHTML === "Blocked" ? "Blocked" : "Unblocked";
 alert(userId)
    alert(userName)
  console.log('Category ID:', userId);
console.log('Name Field:', userName);


  Swal.fire({
    title: 'Are you sure?',
    text: "You won't be able to revert this!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Yes, Block user!'
  }).then((result) => {
    if (result.isConfirmed) {
      fetch(`/admin/blockUser/${userId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        
        body: JSON.stringify({_id:userId, name: userName})
      })
      .then(response => response.json())
      .then(data => {
        Swal.fire(
          'Blocked!',
          'User has been deleted.',
          'success'
        );
        button.innerHTML = currentText === "Blocked" ? "Unblocked" : "Blocked";
       // row.style.opacity = '0.5';  // Visual feedback (dim the row)
        //window.location.href = '/admin/user';
      })
      .catch(error => {
        Swal.fire(
          'Error!',
          'An error occurred while blocking user.',
          'error'
        );
      });
    }
  });
}




</script>
   