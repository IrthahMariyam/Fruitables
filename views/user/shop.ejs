<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Page</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .main-container {
            max-width: 1200px;
            margin: 175px auto 0;
            padding: 20px;
        }
        .shop-topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .search-form {
            display: flex;
            align-items: center;
            background-color: #f1f1f1;
            border-radius: 25px;
            overflow: hidden;
            max-width: 250px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .search-input {
            flex: 1;
            padding: 8px 10px;
            font-size: 14px;
            border: none;
            outline: none;
        }
        .search-button {
            padding: 8px 15px;
            background-color: #81C408;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 14px;
            border-radius: 15px;
            margin-right: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }
        .search-button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
        .sidebar {
            padding: 20px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 20px;
            width: 250px;
        }
        .filter-section {
            margin-bottom: 20px;
        }
        .filter-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
            color: #333;
        }
        .filter-item a {
            text-decoration: none;
            color: #333;
        }
        .filter-item a:hover {
            color: #007bff;
        }
        .product-list-container {
            display: flex;
            gap: 20px;
        }
        .product-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            width: calc(100% - 270px);
        }
        .product-card {
            width: calc(33.333% - 20px);
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            position: relative;
        }
        .product-card img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .wishlist-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: rgba(237, 247, 247, 0.8);
            color: #fff;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
        }
        .add-to-cart-btn {
            background-color: #81C408;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        .pagination {
            text-align: center;
            width: 100%;
            margin-top: 30px;
        }
        .pagination ul {
            display: inline-flex;
            list-style: none;
            padding: 0;
        }
        .pagination .page-item {
            margin: 0 5px;
        }
        .pagination a {
            padding: 8px 12px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            color: #333;
            text-decoration: none;
        }
        .pagination .active {
            background-color: #007bff;
            color: #fff;
        }

 .product-card { position: relative; /* Ensure the card is positioned relatively */ 
  overflow: hidden; /* Hide any overflowing content */ 
  transition: transform 0.3s ease, 
  box-shadow 0.3s ease; } 
.product-card:hover { 
 transform: translateY(-10px);
 box-shadow: 0 0 55px rgba(0, 0, 0, 0.4);
 } /* Add a smooth transition effect to the product image */
.product-card img { 
 transition: transform 0.5s ease; /* Smooth transition for the image */
border-radius: 10px 10px 0 0; /* Rounded corners for the top of the image */
 } /* Slight zoom effect on the image */
 .product-card:hover img {
transform: scale(1.3); /* Zoom in the image */ 
 }

    </style>
</head>
<body>
    <%- include("../../views/partials/user/header") %>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <div class="main-container">
        <section class="shop-page container">
            <div class="shop-topbar">
                <div class="search-bar">
                    <form action="/search" method="get" class="search-form">
                        <input type="text" name="query" placeholder="Search items..." class="search-input" />
                        <button type="submit" class="search-button">Search</button>
                    </form>
                </div>
            </div>
            <div class="product-list-container">
                <aside class="sidebar">
                    <div class="filter-section">
                        <div class="filter-title">Categories</div>
                        <ul>
                            <% for(let i=0; i<category.length; i++) { %>
                                <li class="filter-item" style="list-style: none;">
                                    <a href="/filter?category=<%=category[i]._id%>">
                                        <i class="fas fa-apple-alt me-2" style="color: #81C408;"></i>
                                        <%= category[i].name %>
                                    </a>
                                </li>
                            <% } %>
                        </ul>
                    </div>
                    <div>
                    <div class="filter-section">
                        
                          <form action="/sortproduct" method="get">
                           
                            <!-- Sort Dropdown -->
                             <div>
                            <label for="sortBy">Sort By:</label>
                            <select id="sortBy" name="sortBy">
                             <option value="default">Default</option>
                             <option value="instock">In Stock</option>
                              <option value="newArrivals">New Arrivals</option>
                              <!-- <option value="featured">Featured</option> -->
                              <option value="popularity">Popularity</option>
                              <option value="averageRatings">Average Ratings</option>
                              <option value="priceAsc">Low  to High Price</option>
                              <option value="priceDesc">High  to Low Price</option>
                              <option value="aToZ">Name: A to Z</option>
                              <option value="zToA">Name: Z to A</option>
                            </select>
                        </div>
                            <!-- Submit Button -->
                             
                             <div class="text-center"style="margin-top: 10px;">
                            <button type="submit"  class="search-button">Search</button>
                        </div>
                          </form>
                       </div>
                </aside>
                
                <main class="product-grid">
                    <% for(let i=0; i<products.length; i++) { %>
                      <%console.log(products.length)%>
                        <div class="product-card">
                            <a href="/productDetails?id=<%=products[i]._id%>">
                                <img src="<%=products[i].productImage[0] %>" alt="<%=products[i].productName%>" />
                                <h4><%= products[i].productName %></h4>
                                <p><strike>₹<%= products[i].price %></strike> ₹<%= products[i].salesPrice %></p>
                            </a>
                            <% if (products[i].stock > 0) { %>
                            <button class="add-to-cart-btn" onclick="addToCart('<%= products[i]._id %>')">Add to Cart</button>
                            <% } else { %>
                                <button class="btn btn-secondary" disabled>Out of Stock</button>
                                <% } %>
                        </div>
                    <% } %>
                </main>
            </div>
        </section>
    </div>


<!-- Pagination -->


<div class="pagination" style="text-align: center; width: 100%;">
  <ul style="display: inline-flex; justify-content: center; list-style: none; padding: 0;">
    <% for(let i=1;i<=totalPages;i++){ %>
      <li class="page-item <%=(i===page) ? 'active' : '' %>">
        <a class="page-link" href="?page=<%= i %>"><%= i %></a>
      </li>
    <% } %>
  </ul>
</div>




    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <%- include("../../views/partials/user/footer") %>
    <script> 
        function addToCart(productId) {
            const cartitem=document.getElementById('cartitems')
            fetch('/cart/add', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ productId }),
})
  .then((response) => response.json())
  .then((data) => {
    if (data.message) {
      Swal.fire({
        title: "Success",
        text: "Successfully added to cart",
        icon: "success",
      }).then(() => {
        // Wait for 2.5 seconds before reloading the page
        // setTimeout(() => {
        //   window.location.reload();
        //   cartitem.innerHTML=parseInt(cartitem.value.trim())+1
        // }, 1000);
        if (data.cartitemcount !== undefined) {
          // Get the cart badge element
          const cartItemBadge = document.getElementById('cartitems');

          // Update the badge count with the new total
          cartItemBadge.textContent = data.cartitemcount;
        }
    });
    } else {
      Swal.fire('Error', data.error, 'error');
    }
  })
  .catch((error) => {
    console.error('Error:', error);
    Swal.fire('Error', 'Something went wrong!', 'error');
  });

          }


          function updatePriceRange(value) {
    document.getElementById('minPrice').value = 0;
    document.getElementById('maxPrice').value = value;
  }

  
                            // Function to update price range display
                            function updatePriceRangeDisplay(value) {
                              const maxPrice = document.getElementById("maxPrice");
                              const display = document.getElementById("priceRangeDisplay");
                              maxPrice.value = value;
                              display.textContent = value;
                            }
                          
                          
    </script>     

</body>
</html>















