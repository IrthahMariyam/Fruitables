   
    <style>
      .card-green {
        background-color: #ADD8E6;
      }
      .main {
        padding: 30px 0;
      }
     
     
      .dashboard-menu {
        background-color: #cce3e6;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
     
     
      .dashboard-menu .nav-link {
      font-weight: bold;
      color: #30683c;
      box-shadow: 0 4px 10px rgba(123, 131, 112, 0.3), 0 4px 20px rgba(0, 191, 255, 0.2);
      transition: box-shadow 0.3s ease;
     }
     
     
     .dashboard-menu .nav-link:hover {
      color: #00bfff;
      box-shadow: 0 4px 15px rgba(173, 255, 47, 0.5), 0 6px 25px rgba(0, 191, 255, 0.4);
     }
     
     
      .card {
         border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        margin-bottom: 20px;
      }
     
     
      .card-header {
        background-color: #81C408;
        color: white;
        border-radius: 10px 10px 0 0;
      }
     
     
      .btn-success {
        background-color:#81C408;
        border-color: #6bb87d;
      }
     
     
      .btn-success:hover {
        background-color: #506955;
      }
     
     
      .form-group {
        margin-bottom: 15px;
      }
     
     
      .required {
        color: red;
      }
     
     
       @media (max-width: 768px) {
         .dashboard-menu {
          padding: 10px;
        }
     
     
        .card {
          margin-bottom: 15px;
        }
      }
      .page-header.breadcrumb-wrap {
      background-color: #eee2e9;
      padding: 15px 0;
     }
     
     
     .breadcrumb {
      display: flex;
      align-items: center;
      font-family: 'Arial', sans-serif;
      font-size: 16px;
      color: #121311;
     }
     
     
     .breadcrumb a {
      color: #81C408;
      text-decoration: none;
      position: relative;
      margin: 0 5px;
     }
     
     
     .breadcrumb a:hover {
         color: #0056b3;
     }
     
     
     .breadcrumb span {
      margin: 0 5px;
      color: #999;
     }
     
     
     .breadcrumb a::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      background: #6e6e3a;
      left: 0;
      bottom: -2px;
      transform: scaleX(0);
      transition: transform 0.3s ease;
     }
     
     
     .breadcrumb a:hover::after {
      transform: scaleX(1);
     }
     </style>




<%- include("../../views/partials/user/header") %>  
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.min.js"></script>

      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

      <main class="main">
        <!-- Page Header -->
        <div class="container-fluid page-header py-5">
          <h1 class="text-center text-white display-6">Profile</h1>
          <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item"><a href="/home">Home</a></li>
            <li class="breadcrumb-item active text-white">Profile</li>
          </ol>
        </div>
      
        <!-- Profile Section -->
        <section class="pt-10 pb-10">
          <div class="container">
            <div class="row">
              <div class="col-lg-10 m-auto">
                <div class="row">
                  <!-- Sidebar Menu -->
                  <div class="col-md-4">
                    <div class="dashboard-menu" style="margin-top: 40px;">
                      <ul class="nav flex-column" role="tablist">
                        <li class="nav-item">
                          <a class="nav-link" data-bs-toggle="tab" href="#address"role="tab">
                            <i class="fi-rs-shopping-bag mr-10"></i>Address
                          </a>
                        </li>

                        <li class="nav-item">
                          <a class="nav-link" data-bs-toggle="modal" data-bs-target="#changePasswordModal" >
                            <i class="fi-rs-marker mr-10"></i>Change Password
                          </a>
                        </li>
                       
                        <li>
                          <a class="nav-link" data-bs-toggle="tab" href="#orders" role="tab">
                            <i class="fi-rs-shopping-bag mr-10"></i>Orders
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-bs-toggle="tab" href="#track-orders" role="tab">
                            <i class="fi-rs-shopping-cart-check mr-10"></i>My Order
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link active" href="/home" role="tab">
                            <i class="fi-rs-settings-sliders mr-10"></i>Wishlist
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-bs-toggle="tab" href="#wallet-history" role="tab">
                            <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="javascript:void(0)" id="deleteaccount" onclick="handleDeleteAccount('<%=user._id%>,<%=user.name%>')">
                            <i class="fi-rs-shopping-cart-check mr-10"></i>Delete Account
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="/logout">
                            <i class="fi-rs-sign-out mr-10"></i>Logout
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
      
                  <!-- Main Content -->
                  <div class="col-md-8">
                    <div class="tab-content dashboard-content">
                      <!-- User Profile Tab -->
                      <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                        <div class="card card-green" style="margin-top: 40px;">
                          <div class="card-header">
                            <h5 class="mb-0">User Profile</h5>
                          </div>
                          <div class="card-body " style="margin-left: 40px;">
                            <p><strong>Name:</strong> <%= user.name %></p>
                            <p><strong>Phone:</strong> <%= user.phone %></p>
                            <p><strong>Email:</strong> <%= user.email %></p>
                            
                          </div>
                      </div>
      
                      <!-- Address Tab -->
                      
                      <div class="tab-pane fade" id="address" role="tabpanel">
                        <div class="row">
                          <% if (!address || address.length === 0) { %>
                            <p>No addresses found. Please add one!</p>
                          <% } else { %>
                            <% address.forEach(address => { %>
                              <div class="col-lg-6">
                                <div class="card mb-3">
                                  <div class="card-body">
                                    <address>
                                      <p><strong>Name:</strong> <%= address.name %></p>
                                      <p><strong>Landmark:</strong> <%= address.landmark %></p>
                                      <p><strong>District:</strong> <%= address.district %></p>
                                      <p><strong>State:</strong> <%= address.state %></p>
                                      <p><strong>Pincode:</strong> <%= address.pincode %></p>
                                      <p><strong>Phone:</strong> <%= address.phone %></p>
                                    </address>
                                    <div class="d-flex justify-content-between">
                                      <!-- Edit Button -->
                                      <button
                                        class="btn btn-primary btn-sm"
                                        onclick="openEditAddressModal('<%= address._id %>')">
                                        Edit
                                      </button>
                                      <!-- Delete Button -->
                                      <form
                                        action="/deleteAddress/<%= address._id %>"
                                        method="POST"
                                        onsubmit="return confirm('Are you sure you want to delete this address?');">
                                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                      </form>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <% }) %>
                          <% } %>
                        </div>
                        <div>
                        <button class="btn btn-primary w-70" onclick="openAddAddressModal('<%= user._id %>')">Add Address</button>

                        </div>
                      </div>
      
                      <!-- Orders Tab -->
                      <div class="tab-pane fade" id="orders" role="tabpanel">
                        <div class="card">
                          <div class="card-header">
                            <h5 class="mb-0">Your Orders</h5>
                          </div>
                          <div class="card-body">
                            <table class="table">
                              <thead>
                                <tr>
                                  <th>Order</th>
                                  <th>Status</th>
                                  <th>Total</th>
                                  <th>Actions</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td colspan="4" class="text-center">No orders found.</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
      
                      <!-- Wallet Tab -->
                      <div class="tab-pane fade" id="track-orders" role="tabpanel">
                        <div class="card">
                          <div class="card-header">
                            <h5 class="mb-0">Wallet</h5>
                          </div>
                          <div class="card-body text-center">
                            <form>
                              <div class="form-group">
                                <label for="walletAmount" class="h4">Amount</label>
                                <div class="h3">₹0</div>
                              </div>
                              <button type="button" class="btn btn-success">Add Money</button>
                            </form>
                          </div>
                        </div>
                      </div>
      
                      <!-- Wallet History Tab -->
                      <div class="tab-pane fade" id="wallet-history" role="tabpanel">
                        <div class="card">
                          <div class="card-header">
                            <h5 class="mb-0">Wallet History</h5>
                          </div>
                          <div class="card-body">
                            <table class="table">
                              <thead>
                                <tr>
                                  <th>Date</th>
                                  <th>Status</th>
                                  <th>Amount</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td colspan="3" class="text-center">No transactions found.</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
      
                      <!-- Referral Tab -->
                      <div class="tab-pane fade" id="referal" role="tabpanel">
                        <div class="card">
                          <div class="card-header">
                            <h5 class="mb-0">Referral</h5>
                          </div>
                          <div class="card-body">
                            <p>Share this link: <strong>[Referral Link]</strong></p>
                            <p>Earned: ₹0</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- End Main Content -->
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
      
<!-- <div class="container-fluid copyright bg-dark py-4">
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center text-md-start mb-3 mb-md-0 ">
            Fruitables
            </div>
          
        </div>
    </div>
</div> -->


 <!-- Change Password Modal -->
 <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true"> 
  <div class="modal-dialog"> 
    <div class="modal-content"> 
      <div class="modal-header">
         <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
         <input type="text" class="form-control" id="userid" value=" <%= user._id %>" hidden> 
          </div> 
         <div class="modal-body"> 
          <form id="changePasswordForm">
            <div class="mb-3">
               <label for="oldPassword" class="form-label">Old Password</label>
               
               <input type="password" class="form-control" id="oldPassword" required> 
              </div> 
              <div class="mb-3"> 
                <label for="newPassword" class="form-label">New Password</label>
           <input type="password" class="form-control" id="newPassword" required>
           </div>
            <div class="mb-3">
               <label for="confirmPassword" class="form-label">Confirm Password</label>
               <input type="password" class="form-control" id="confirmPassword" required> 
           </div>
           <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary me-2">Change Password</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Close">Close</button>
          </div>
        </form>
      </div>
    </div>
   </div>
 </div>

<!-- Modal for Add/Edit Address -->
<!-- Add Address Modal -->
<div class="modal fade" id="addressModal" tabindex="-1" aria-labelledby="addressModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addressModalLabel">Add Address</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addressForm">
      <input type="hidden" id="userId" name="userId">
      

          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" class="form-control" id="name" placeholder="Enter name" required>
          </div>
          <div class="mb-3">
            <label for="landmark" class="form-label">Landmark</label>
            <input type="text" class="form-control" id="landmark" placeholder="Enter landmark" required>
          </div>
          <div class="mb-3">
            <label for="District" class="form-label">District</label>
            <input type="text" class="form-control" id="District" placeholder="Enter district" required>
          </div>
          <div class="mb-3">
            <label for="state" class="form-label">State</label>
            <input type="text" class="form-control" id="state" placeholder="Enter state" required>
          </div>
          <div class="mb-3">
            <label for="pincode" class="form-label">Pincode</label>
            <input type="text" class="form-control" id="pincode" placeholder="Enter pincode" required>
          </div>
          <div class="mb-3">
            <label for="phone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="phone" placeholder="Enter phone number" required>
          </div>
          <button type="submit" class="btn btn-primary">Save Address</button>
        </form>
      </div>
    </div>
  </div>
</div>




 


<!-- JavaScript Libraries -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>


<!-- Template Javascript -->



<script>

   function handleDeleteAccount(userId,user) {
    //alert("dsfadsfasdf")
    console.log("Inside delete:", userId);

    Swal.fire({
      title: 'Are you sure?',
      text: "You won't be able to revert this!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Yes, Delete Account!'
    }).then((result) => {
      if (result.isConfirmed) {
        fetch(`/deleteAccount/${userId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ _id: userId, name: user })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          Swal.fire(
            'Deleted!',
            'Your account has been deleted.',
            'success'
          );
          window.location.href = '/logout';
        })
        .catch(error => {
          console.error('Error:', error);
          Swal.fire(
            'Error!',
            'An error occurred while deleting your account.',
            'error'
          );
        });
      }
    });
  }



  function validatePassword(password) { 
    const alpha = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!&])[A-Za-z\d@$!&]{8,16}$/; 
    return alpha.test(password); 
  } 
  document.getElementById('changePasswordForm').addEventListener('submit', async function(event) {
  event.preventDefault();

  const oldPassword = document.getElementById('oldPassword').value;
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const userId = document.getElementById('userid').value.trim()
  


  if (!validatePassword(newPassword)) {
    alert('New password must be 8-16 characters long, include at least one letter, one number, and one special character (@$!&).');
    return;
  }

  if (newPassword !== confirmPassword) {
    alert('New Password and Confirm Password do not match.');
    return;
  }

  const result = await Swal.fire({
    title: 'Are you sure?',
    text: "Your password will be changed!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Yes, Change Password!'
  });

  if (result.isConfirmed) {
    try {
      
      const response = await fetch(`/changePassword/${userId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ userId, oldPassword, newPassword })
      });

      if (!response.ok) {
        throw new Error('Network response was not ok');
      }

      const data = await response.json();

      Swal.fire(
        'Changed!',
        'Your password is changed.',
        'success'
      );
      window.location.href = `/userProfile/${userId}`;

    } catch (error) {
      console.error('Error:', error);
      Swal.fire(
        'Error!',
        'An error occurred while changing the password.',
        'error'
      );
    }
  }
});


 // Open modal for adding address
 function openAddAddressModal(userId) {
    document.getElementById('addressForm').reset();
    const userIdInput = document.getElementById('userId');
  if (userIdInput) {
    userIdInput.value = userId; // Set the user ID in the hidden input
    console.log('User ID set in modal:', userId);
  } else {
    console.error('Hidden input for user ID not found.');
  }
 
    document.getElementById('addressModalLabel').textContent = 'Add Address';
    new bootstrap.Modal(document.getElementById('addressModal')).show();
  }

  // Open modal for editing address
  function openEditAddressModal(addressId) {
    fetch(`/getAddress/${addressId}`)
      .then((res) => res.json())
      .then((data) => {
        
        document.getElementById('name').value = data.name;
        document.getElementById('landmark').value = data.landmark;
        document.getElementById('District').value = data.District;
        document.getElementById('state').value = data.state;
        document.getElementById('pincode').value = data.pincode;
        document.getElementById('phone').value = data.phone;
        document.getElementById('addressModalLabel').textContent = 'Edit Address';
        new bootstrap.Modal(document.getElementById('addressModal')).show();
      })
      .catch((err) => console.error(err));
  }

  // Submit form for Add/Edit
  document.getElementById('addressForm').addEventListener('submit', function (e) {
  e.preventDefault(); // Prevent form submission
  
  // Retrieve form values
  alert("inssidsg")
  const name = document.getElementById('name').value.trim();
const userId=document.getElementById('userId').value.trim()
alert(userId)
  console.log(name)
  const landmark = document.getElementById('landmark').value.trim();
  console.log(landmark)
  const district = document.getElementById('District').value.trim();
  console.log(district)
  const state = document.getElementById('state').value.trim();
  console.log(state)
  const pincode = document.getElementById('pincode').value.trim();
  console.log(pincode)
  const phone = document.getElementById('phone').value.trim();
  console.log(phone)
 
  
  // Validation
  const validIndianPattern = /^[6-9]\d{9}$/; // Validates Indian phone numbers
  const invalidPattern = /^(.)\1{9}$/; // Checks if all digits are the same
  
  if (!name || !landmark || !district || !state || !pincode || !phone) {
    alert('Please fill all fields!');
    return;
  }
  if (invalidPattern.test(phone)) {
    alert('Phone number cannot be all the same digit.');
    return;
  }
  if (!validIndianPattern.test(phone)) {
    alert('Enter a valid Indian phone number.');
    return;
  }

  // Prepare API call details

  alert("inside")

  const bod = {
    userId:userId,
    name: name,
    landmark: landmark,
    district: district,
    state: state,
    pincode: pincode,
    phone: phone,
  };
  alert(userId,name,landmark,district,state,pincode,phone)
 
  // Make API call
  fetch('/addAddress', {
    method: 'POST',    // Change 'post' to 'POST' to match HTTP method names
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      Id:userId,
        name: name,
        landmark: landmark,
        district: district,
        state: state,
        pincode: pincode,
        phone: phone
    })
})
.then(response => response.json())
      .then(data => {
        Swal.fire(
          'Added!',
          'address added successfully.',
          'success'
        );
    window.location.reload(); // Reload page to reflect changes
})
.catch((err) => {
  Swal.fire(
          'Error!',
          'An error occurred while blocking user.',
          'error'
        );
});
});





  // Delete address
  function deleteAddress(addressId) {
    if (confirm('Are you sure you want to delete this address?')) {
      fetch(`/deleteAddress/${addressId}`, {
        method: 'DELETE',
      })
        .then((res) => res.json())
        .then((data) => {
          alert(data.message);
          window.location.reload();
        })
        .catch((err) => console.error(err));
    }
  }

  
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<%- include("../../views/partials/user/footer") %>
</body>

</html>



